
/*
	key:F7
	详细功能：
	---switch-----------------
    F7 -> G -> 切换F5/F6功能: 跳转/添加跳转关系 
    F7 -> S -> 切换F5/F6功能: 多条件搜索/添加条件 
    F7 -> B -> 切换--/F6功能: 多工程文件对比, 设置对比工程  (不支持目录)
    ---no switch--------------
    F7 -> U: 更新SVN 
    F7 -> I: 提交SVN, 默认设置project 
    F7 -> V -> 对比依次选中的2段代码
    F7 -> C -> 对比(同切换后的F6)
    F7 -> E -> 1/2/3/4/5: 编辑F5跳转关系/编辑F10菜单组/编辑F11宏说明
    
    F7 -> X -> 清除.mk注释  (未实现)
    F7 -> L -> build-查宏-显示在si  (未实现)
    F7 -> M -> build-查log   type app* |find  "SPEAK" > log.txt  (未实现)
    F7 -> F -> 批处理-当前路径文件名  (未实现)

	
Fun list:
	macro _TempHeadF7(hbuf){}
Tools()
	SwtichTools(cmd)
	SelEditFile(key)
	ShowToolsMode(mode)
TwoWordFind(key)
	SetProjectDir(pathName)
	AddParam(key)
BCompare(s)
	BComSetPath(hbuf)
	ShowBCompareMode(val)
SVN()
	SvnUpdate(key)
	SvnCommit(key)
	getSVNCommitPath(pathName)

*/

macro Tools()
{
	//_TempHeadF7(hbuf)
	var key
	var mode
	var modeNew
	
	mode = ReadMode(getToolsRow(0))
	//这里添加F7-显示列表
	ShowToolsMode(mode)

	
	//这里添加F7-功能项
	key = GetKey()
	if(key<97)
		key = key + 32	//小写->大写

	if (key == 98) 		 //字母B    tools: F5--Goto    F6--BComp,   并设置Beyond Compare比较路径
	{
		BComSetPath("")
	}
	else if (key == 99) //字母C
	{
		BCompare("")
		return
	}
	else if (key == 101) //字母E
	{
		SelEditFile(key)
		return
	}
	else if (key == 102) //字母F
	{
		OpenEditDir(key)
		return
	}
	else if (key == 103) //字母G  tools: F5--Goto    F6--Rule
	{
	}
	else if (key == 115) //字母S  tools: F5--Search  F6--AddParam
	{
	}
	else if (key == 105) //字母i
	{
	    SvnCommit(key)
		return
	}
	else if (key == 114) //字母R
	{
	    hbuf = GetCurrentBuf()
		if (hbuf != 0)
			AddRule(hbuf)
		return
	}
	else if (key == 117) //字母u
	{
	    SvnUpdate(key)
		return
	}
	else if (key == 118) //字母v
	{
	    BCompareSel(key)
		return
	}
	else if (key == 120) //字母X
	{
	    DeleteMkComment(key)
		return
	}
	else
	{
		msg (CharFromKey(key) # " @key@")
		return
	}

	//save switch:G S B
	modeNew = CharFromKey(key)
	if (mode != modeNew)
	{
		SaveMode(getToolsRow(0), "@modeNew@")
	}
}


//切换F5/F6到其他命令
macro SwtichTools(cmd)
{
	//_TempHeadF7(hbuf)
	val = ReadMode(getToolsRow(0))		//获取当前设置:默认F5~goto           F6-rule
	
	if(cmd == "F5")
	{
		if(val == "g")			//Goto -- Rule
		{
			return 1
		}
		else if(val == "s")		//Search -- AddParam
		{
			TwoWordFind(0)
			return 0
		}
		else if(val == "b")		//Goto -- BComp
		{
			return 1
		}
		else
		{
			return 1			//default : Goto
		}
	}
	else if(cmd == "F6")
	{
		if(val == "g")			//Goto -- Rule
		{
			return 1
		}
		else if(val == "s")		//Search -- AddParam
		{
			AddParam(0)
			return 0
		}
		else if(val == "b")		//Goto -- BComp
		{
			BCompare("")
			return 0
		}
		else
		{
			msg ("other work")
			return 0
		}
	}
}

//edit
macro SelEditFile(key)
{
	//_TempHeadF7(hbuf)
	mode = CharFromKey(AsciiFromChar(mode)-32)
	toolsMsg = "select edit file : " # CharFromKey(13)
	toolsMsg = toolsMsg # "1: Macro_Rule_Key_file.h"  # CharFromKey(13)
	toolsMsg = toolsMsg # "2: Macro_Rule_Han_file.h"  # CharFromKey(13)
	toolsMsg = toolsMsg # "3: Macro_Group_Menu.h"  # CharFromKey(13)
	toolsMsg = toolsMsg # "4: Macro_Group_Make.h"  # CharFromKey(13)
	toolsMsg = toolsMsg # "5: Macro_Note_Short.h"  # CharFromKey(13)
	toolsMsg = toolsMsg # "6: Macro_Note_Long.h"  # CharFromKey(13)
	msg ("@toolsMsg@")
	
	key = GetKey()
	if(key>48 && key<=48+5)
	{
		if (key == 49) 		 //1
		{
			OpenExistFile(getNodePath(0) # "\\Macro_Rule_Key_file.h")
		}
		else if (key == 50) //2
		{
			OpenExistFile(getNodePath(0) # "\\Macro_Rule_Han_file.h")
		}
		else if (key == 51) //3
		{
			OpenExistFile(getNodePath(0) # "\\Macro_Group_Menu.h")
		}
		else if (key == 52) //4
		{
			OpenExistFile(getNodePath(0) # "\\Macro_Group_Make.h")
		}
		else if (key == 53) //5
		{
			OpenExistFile(getNodePath(0) # "\\Macro_Note_Short.h")
		}
		else if (key == 54) //6
		{
			OpenExistFile(getNodePath(0) # "\\Macro_Note_Long.h")
		}
	}
	else
	{
		msg (CharFromKey(key) # " @key@")
	}
}

//edit
macro OpenEditDir(key)
{
	ret = ShellExecute("explore", getNodePath(0), "", "", 1)
}

//test
macro ShowToolsMode(mode)
{
	//_TempHeadF7(hbuf)
	mode = CharFromKey(AsciiFromChar(mode)-32)
	toolsMsg = "Tools Mode : [ @mode@ ]" # CharFromKey(13)
	toolsMsg = toolsMsg # "---switch-----------------"   # CharFromKey(13)
	toolsMsg = toolsMsg # "G: F5--Goto    F6--Rule"  # CharFromKey(13)
	toolsMsg = toolsMsg # "S: F5--Search  F6--AddParam"   # CharFromKey(13)
	toolsMsg = toolsMsg # "B: F5--Goto    F6--BComp"   # CharFromKey(13)
	toolsMsg = toolsMsg # "---no switch--------------"   # CharFromKey(13)
	toolsMsg = toolsMsg # "U: Svn Update"   # CharFromKey(13)
	toolsMsg = toolsMsg # "I  : Svn Commit"   # CharFromKey(13)
	toolsMsg = toolsMsg # "C: BComp  (once)"   # CharFromKey(13)
	toolsMsg = toolsMsg # "R: Rule       (once)"   # CharFromKey(13)
	toolsMsg = toolsMsg # "V: BComp Select  (1,2)"   # CharFromKey(13)
	toolsMsg = toolsMsg # "X: Del SR #.."   # CharFromKey(13)
	toolsMsg = toolsMsg # "E: Edit ..."   # CharFromKey(13)
	toolsMsg = toolsMsg # "F: Edit Dir"   # CharFromKey(13)
	//toolsMsg = toolsMsg # "C: Color"   # CharFromKey(13)
	msg ("@toolsMsg@")
}
