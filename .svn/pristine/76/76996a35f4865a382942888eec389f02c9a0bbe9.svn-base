
/*
	key:F1 (按F1后再按0~9、A~Z、F2~F12)
	快捷键：
	F1 -> 0~9: 		... (按1提示)
	F1 -> A~Z: 		... (按A提示)
	F1 -> F2~F12: 	显示 F2~F12 功能说明

	详细功能：
    F1 -> 1 提示 功能0~9
          2 project, 版本号, 跳转到 version_software_mocor.h
          3 project, 资源  ,   跳转到 common_mdu_def.h
          4 project, 语言,     跳转到 mmi_custom_define.h          -> MMISET_EDEFAULT_LANGUAGE 
          5 project, 主菜单,    跳转到 mmi_menutable_XXx160.c       -> menu_mainmenu_icon
          6 project, 音量,     跳转到 mmienvset_internal.h
          7 打开目录 \\resource\\RING
          8 打开Build目录
          9 设置默认mk (在mk中; 或在搜索结果窗口，选择mk名称)
          0 跳到默认mk
          - 下载工具. 
          + 下载工具 并设置当前pac
          Back 打开SR
          
    F1 -> A 提示 功能A~Z
          B 修改.em后, 对比文件SI与SI_bak
          C 打开 cmd窗口 编译驱动
          D 打开 显示输入按键编码(test)
          E open project(打开后不能编辑)
          F 
          G 
          H 
          I 选中文字的ascii   【新加】
          J 
          K 显示 SI常用快捷键
          L 创建桌面lnk
          M 打开选择的Make
          N 复制当前文件名
          O 打开目录 (6531DA/bt/6531E/6533/soft/save目录)
          P 项目切换
          Q 清空剪切板
          R 检查mk文件宏重复
          S 打开SR
          V 搜索版本号
          W 关闭多余win
          X 清除.mk右侧内容，用于对比
          
    F1 -> F1， 提示	                              
          F2/F5/F6/F7/F9/F10/F11/F12  详细功能提示

	其他：
          1.F1作为公共宏调试，F1->T作为宏F1调试
          2.F1->D 显示输入按键编码
          3.F1->E open project
		
          


	其他：
    若所有窗口关闭, 按F1/F2/F9/F10/F11/F12, 打开搜索结果窗口


Fun list:
macro _TempHeadF1(hbuf){}
Tree()
	TreeTest()
	TreeNum()
	TreeChar()
	TreeFNum()
	TreeOther(hbuf)

Common:
	SearchVersion(hbuf)
	CloseNonDirty()
	DeleteTxtRightMk(hbuf)
	AddLink(hbuf) 

CommonTest(hbuf, key)
OpenF1Test(hbuf)


	其他：在base工程 SR窗口，F1默认为 临时测试 CtrlTest(hbuf)
*/
macro Tree()
{
	//_TempHeadF1()
    hwnd = GetCurrentWnd()
    hbuf = GetCurrentBuf()
	if (hwnd == 0)
	{
    	hbuf = OpenDefaultSR(hbuf)
    	stop
	}

	//F1 as common test
	CommonTest(hbuf)
    
	key = GetKey()
	if (key >= 48 && key <= 57 )                     // 数字0~9
	{
		TreeNum(hbuf, key)
	}
	else if (key >= 97 && key <= 122 )               // 字母a~z
	{
		TreeChar(hbuf, key)
	}
	else if (key >= 4208 && key <= 4219)             // F1~F12  显示f1~f12 功能说明
	{
		TreeFNum(hbuf, key-4207)
	}
	else if (key >= 1048688 && key <= 1048699 )      // F1~F12  显示f1~f12 功能说明
	{
		TreeFNum(hbuf, key-1048687)
	}
	else                                             //Other: -,+,back,del,方向键
	{
		TreeOther(hbuf, key)
	}
}

macro TreeNum(hbuf, key)
{
	//_TempHeadF1()
	if (key == 49) //数字1
	{
		//help
		ShowHelp(hbuf, "ShowF1Num")
	}
	else if (key == 50) //数字2
	{
		file = "\\resource\\version_software_mocor.h"
		OpenProjectFile(hbuf, file, "", "")
	}
	else if (key == 51) //数字3
	{
		file = "\\resource\\common_mdu_def.h"
		OpenProjectFile(hbuf, file, "", "")
	}
	else if (key == 52) //数字4
	{
		file = "\\resource\\mmi_custom_define.h"
		word = "MMISET_EDEFAULT_LANGUAGE"
		OpenProjectFile(hbuf, file, "", word)
	}
	else if (key == 53) //数字5
	{
		file1 = "\\resource\\mmi_menutable_128x160.c"
		file2 = "\\resource\\mmi_menutable_240x320.c"
		word = "menu_mainmenu_icon"
		OpenProjectFile(hbuf, file1, file2, word)
	}
	else if (key == 54) //数字6
	{
		file = "\\resource\\mmienvset_internal.h"
		OpenProjectFile(hbuf, file, "", "")
	}
	else if (key == 55) //数字7
	{
		file = "\\resource\\RING"
		OpenProjectFile(hbuf, file, "", "")
	}
	else if (key == 56) //数字8
	{
		OpenBuildDir(hbuf)
	}
	else if (key == 57) //数字9
	{
		//设置默认mk
		SetDefaultMake(hbuf)
	}
	else if (key == 48) //数字0
	{
		//跳到默认mk
		OpenDefaultMake(hbuf)
	}
}

macro TreeChar(hbuf, key)
{
	//_TempHeadF1()
	if (key == 97) //字母A
	{
		ShowHelp(hbuf, "ShowF1Char")
	}
	else if (key == 98) //字母B
	{
		path1 = getSavePath(0) # "\\SI"
		path2 = getSavePath(0) # "\\SI_bak"
		ShellBCompare(path1, path2)
	}
	else if (key == 99) //字母C
	{
		OpenCmdFile(hbuf)
	}
	else if (key == 100) //字母D
	{
		newkey = GetKey()
		msg ("key @newkey@")
	}
	else if (key == 105) //字母I
	{
		ShowSelAscii(hbuf)
	}
	else if (key == 107) //字母K  SI常用快捷键
	{
		ShowHelp(hbuf, "ShowK")
	}
	else if (key == 108) //字母L  add link
	{
		AddLinkProjectName(hbuf)
	}
	else if (key == 109) //字母M  open mk
	{
		OpenSelMakeFile(hbuf)
	}
	else if (key == 110) //字母N  show filename
	{
		ShowFileName(hbuf, true)
	}
	else if (key == 111) //字母O open file dir
	{
		OpenProjectBase(hbuf)
	}
	else if (key == 112) //字母P open project
	{
		open_project
	}
	else if (key == 113) //字母Q clear clip
	{
		hbufClip = GetBufHandle("Clipboard")
		EmptyBuf(hbufClip)
	}
	else if (key == 114) //字母R  检查重复 48S 很久
	{
		ChkRepeat(hbuf)
	}
	else if (key == 115) //字母S
	{
		OpenDefaultSR(hbuf)
	}
	else if (key == 116) //字母T
	{
		OpenF1Test(hbuf)
	}
	else if (key == 118) //字母V  search version
	{
		SearchVersion(hbuf)
	}
	else if (key == 119) //字母W  close windows
	{
		WindowsCloseStyleOne(hbuf)
	}
	else if (key == 120) //字母X  清除.mk右侧内容，用于对比
	{
		DeleteTxtRightMk(hbuf)
	}
	else
	{
		msg ("key @key@")
	}
}

macro TreeFNum(hbuf, key)
{
	//_TempHeadF1()
	if (key == 1) //F1
	{
		//ShowHelp(hbuf, "ShowF1FNUM")
		ShowHelpLoop(hbuf)				//Loop
	}
	else //F2~F12
	{
		if(key - 1>=10)
		{
			chr = "1" # CharFromKey(key - 1 + 49 -10)
		}
		else if(key - 1==9)
		{
			chr = "10"
		}
		else
		{
			chr = CharFromKey(key - 1 + 49)
		}
		ShowHelp(hbuf, "ShowF" # chr)
	}
}


macro TreeOther(hbuf, key)
{
	//_TempHeadF1()
	if (key == 45) //-
	{
		// 下载
		OpenToolsDownload(hbuf, False)
	}
	else if (key == 61) //+
	{
		// 下载并初始化路径
		OpenToolsDownload(hbuf, TRUE)
	}
	else if (key == 8) //back
	{
		// 打开SR
    	OpenDefaultSR(hbuf)
	}
	else
	{
		msg ("key @key@")
	}
}


macro ShowHelpLoop(hbuf)
{
	//_TempHeadF1()
	ShowHelp(hbuf, "ShowF1Loop")
	baseStr = ""
	ret = 0
	key = GetKey()
	if (key == 49) // 1
	{
		ret = ShowHelp(hbuf, "ShowF1FNUM")	//F1~F12
		baseStr = "ShowF"
	}
	else if (key == 50) //2
	{
		ret = ShowHelp(hbuf, "ShowF1Num")		//F1->0~9, -,+,back
		baseStr = "Show"
	}
	else if (key == 51) //3
	{
		ret = ShowHelp(hbuf, "ShowF1Char")	//F1->A~Z
		baseStr = "Show"
	}
	else if (key == 52) //4
	{
		ret = ShowHelp(hbuf, "ShowF1Ctrl")	//Ctrl B,E,T
		baseStr = "ShowCtrl"
	}
	else if (key >= 4208 && key <= 4219)      // F1~F12  显示f1~f12 功能说明
	{
		if(key - 4208>=10)
		{
			chr = "1" # CharFromKey(key - 4208 + 49 -10)
		}
		else if(key - 4208==9)
		{
			chr = "10"
		}
		else
		{
			chr = CharFromKey(key - 4208 + 49)
		}
		ret = ShowHelp(hbuf, "ShowF" # chr)
	}
	else if (key >= 1048688 && key <= 1048699)      // F1~F12  SI3.5, 4.0 code不一样
	{
		if(key - 1048688>=10)
		{
			chr = "1" # CharFromKey(key - 1048688 + 49 -10)
		}
		else if(key - 1048688==9)
		{
			chr = "10"
		}
		else
		{
			chr = CharFromKey(key - 1048688 + 49)
		}
		ret = ShowHelp(hbuf, "ShowF" # chr)
	}
	else
	{
		msg ("key @key@")
	}

	while (ret > 0)
	{
		key = GetKey()//1048688
		if (key >= 4208 && key <= 4219)      // F1~F12  显示f1~f12 功能说明
		{
			if(key - 4208>=10)
			{
				chr = "1" # CharFromKey(key - 4208 + 49 -10)
			}
			else if(key - 4208==9)
			{
				chr = "10"
			}
			else
			{
				chr = CharFromKey(key - 1048688 + 49)
			}
		}
		else if (key >= 1048688 && key <= 1048699)
		{
			if(key - 1048688>=10)
			{
				chr = "1" # CharFromKey(key - 1048688 + 49 -10)
			}
			else if(key - 1048688==9)
			{
				chr = "10"
			}
			else
			{
				chr = CharFromKey(key - 1048688 + 49)
			}
		}else
		{
			chr = CharFromKey(key)
		}
		ret = ShowHelp(hbuf, baseStr # chr)
		baseStr = baseStr # chr # "_"
	}
}

//ret isLoop
macro ShowHelp(hbuf, key)
{
	//_TempHeadF1(hbuf)
	mFile = getNodePath(0) # "\\Show_Help.h"
	mBuf = OpenCache(mFile)
	
	helpStrStart = key # ":start"
	helpStrEnd = key # ":end"
	mSelStart = SearchInBuf(mBuf, helpStrStart, 0, 0, FALSE, FALSE, FALSE)
	mSelEnd = SearchInBuf(mBuf, helpStrEnd, 0, 0, FALSE, FALSE, FALSE)
	helpTxt = ""
	ret = 0

	if (mSelStart != "" && mSelEnd != "")
	{
		ln = mSelStart.lnFirst + 1
		while (ln <  mSelEnd.lnFirst)
		{
			line = GetBufLine(mBuf, ln)
			helpTxt = helpTxt # line # CharFromKey(13)
			ln = ln + 1
		}
		if(helpTxt != "")
		{
			msg ("@helpTxt@")
		}
		
		lastLine = GetBufLine(mBuf, mSelEnd.lnFirst)
		lastLen = strlen(lastLine)
		if(strmid(lastLine, lastLen - 4, lastLen) == "loop")
		{
			ret = 1
		}
	}
	return ret
}

macro CommonTest(hbuf)
{
	//F1作为(其他宏)通用宏测试; 
	//F1->T测试F1的功能[OpenF1Test()]
	if(IsFileType(hbuf, ".em"))
	{
		if(IsFileName(hbuf, "sbd_f1.em")) // no use, use F1->T test
		{
			//OpenF1Test(hbuf)
			return
		}
		else if (IsFileName(hbuf, "sbd_f2.em"))
		{
			OpenPathTest(hbuf)
		}
		else if (IsFileName(hbuf, "sbd_f5.em"))
		{
			OpenF5Test(hbuf)
		}
		else if (IsFileName(hbuf, "sbd_f6.em"))
		{
			OpenF6Test(hbuf)
		}
		else if(IsFileName(hbuf, "sbd_f9.em"))
		{
			SearchTest(hbuf)
		}
		else if(IsFileName(hbuf, "sbd_f10.em"))
		{
			OpenF10Test(hbuf)
		}
		else if(IsFileName(hbuf, "sbd_f11.em"))
		{
			OpenF11Test(hbuf)
		}
		else if(IsFileName(hbuf, "sbd_f12.em"))
		{
			OpenF12Test(hbuf)
		}
		else if (IsFileName(hbuf, "sbd_ctrl.em"))
		{
			CtrlTest(hbuf)
		}
		else if (IsFileName(hbuf, "sbd_string.em"))
		{
			OpenStringTest(hbuf)
		}
		else if (IsFileName(hbuf, "sbd_shell.em"))
		{
			OpenShellTest(hbuf)
		}
		else if (IsFileName(hbuf, "sbd_test.em"))
		{
			OpenAPITest(hbuf)
		}
		else
		{
			OpenAPITest(hbuf)
		}
		stop
	}
}

macro OpenF1Test(hbuf)
{
	//Tree()
	var ret
	var source
	var target
	source = "Search Results"
	
	target = "ch"
	ret = LFindString( source, target )
	msg ("ret " # "@ret@" # " @target@")
	
	target = "Se"
	ret = LFindString( source, target )
	msg ("ret " # "@ret@" # " @target@")
	
	target = "ch"
	ret = FindString( source, target )
	msg ("ret " # "@ret@" # " @target@")
	
	target = "CH"
	ret = FindString( source, target )
	msg ("ret " # "@ret@" # " @target@")
}

