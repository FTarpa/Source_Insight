/***********************************************************************//****************************    SVN  *********************************//***********************************************************************/macro BCompare(s){	//_TempHeadF7(hbuf)	hwnd = GetCurrentWnd()	hbuf = GetCurrentBuf()	if (hwnd == 0)	{    	hbuf = OpenDefaultSR(hbuf)    	stop	}	path1 = GetBufName(hbuf)	baseDir = getBasePath(path1)	baseVal = getBaseType(path1)/10	path2 = strmid(path1, strlen(baseDir), strlen(path1))		val = ReadMode(getBCompareRow(0))//1~6	val_old = val/100	val = val - (val/100)*100	if(val == baseVal)	{		//避免当前项目与自己对比		val = val_old	}		if(baseVal == 6)	{		if(val != 6)		{			tmp_path = strmid(path1, strlen(baseDir), strlen(path1))			if(strlen(tmp_path)>strlen("MS_MMI_Main")+1)			{				tmp_path2 = strmid(tmp_path, 1, 1 + strlen("MS_MMI_Main"))				if(strmid(tmp_path, 1, 1 + strlen("MS_MMI_Main")) == "MS_MMI_Main")				{					path2 = "\\MS_MMI" # strmid(tmp_path, strlen("MS_MMI_Main")+1, strlen(tmp_path))				}			}		}	}	else if(val == 6)//7701	{		tmp_path = strmid(path1, strlen(baseDir), strlen(path1))		if(strlen(tmp_path)>strlen("MS_MMI")+1)		{			tmp_path2 = strmid(tmp_path, 1, 1 + strlen("MS_MMI"))			if(strmid(tmp_path, 1, 1 + strlen("MS_MMI")) == "MS_MMI")			{				path2 = "\\MS_MMI_Main" # strmid(tmp_path, strlen("MS_MMI")+1, strlen(tmp_path))			}		}	}	path2 = getProjectFromList(val * 10) # path2	if (path2 != "")	{		ShellBCompare(path1, path2)	}}macro BComSetPath(s){	//_TempHeadF7(hbuf)	val = ReadMode(getBCompareRow(0))	val = val - (val/100)*100	ShowBCompareMode(val)	key = GetKey()	if (key >= 49 && key <= 48 + 6)	{		mode = key - 48		if(val != mode)		{			hbuf = GetCurrentBuf()			if (hbuf != 0)			{				szpathName = GetBufName(hbuf)				filename = GetFileName(szpathName)				//增加功能：A->B比; B->A比; 避免A->A比				n = getBaseType(szpathName)/10			}			else			{		    	n = 0			}			n = n*100 + mode			SaveMode(getBCompareRow(0), "@n@")		}		msg ("set ok!    (@mode@)")	}	else	{		msg (CharFromKey(key) # " @key@")	}}//testmacro ShowBCompareMode(val){	//_TempHeadF7(hbuf)	//一般常用path在10、20、30...	bComMsg = "BCompare Mode : [@val@]" # CharFromKey(13)	bComMsg = bComMsg # "1: " # getProjectFromList(10) # CharFromKey(13)	bComMsg = bComMsg # "2: " # getProjectFromList(20) # CharFromKey(13)	bComMsg = bComMsg # "3: " # getProjectFromList(30) # CharFromKey(13)	bComMsg = bComMsg # "4: " # getProjectFromList(40) # CharFromKey(13)	bComMsg = bComMsg # "5: " # getProjectFromList(50) # CharFromKey(13)	bComMsg = bComMsg # "6: " # getProjectFromList(60) # CharFromKey(13)	msg ("@bComMsg@")}macro ShowBCompareModeExt(basePath){	var err	var n	var path		n = 10	err = 0	while (1)	{		path = getProjectFromList(n) //遍历路径列表				if("" == path){			if(0 == n-n/10*10 || 100 == n){ //余数为0, 结果搜索				return err			}else{				n = (1 + n/10)*10	//加10				continue			}		}else{			if(basePath == path){				return n			}else{				n = n + 1				continue			}		}	}}macro BCompareSel(key){	//_TempHeadF7(hbuf)	onoff = ReadMode(getBCompareOnOff(0))	    hbuf = GetCurrentBuf()	if (hwnd == 0)	{    	stop	}		sel = MGetWndSel(hbuf)	if (!IsHasSelect(sel))	{		return	}		if (onoff == 1)	{		tarFile = "Tmp_Comp_1.h"	}	else	{		tarFile = "Tmp_Comp_2.h"	}		    tmpBuf = OpenCache(getNodePath(0) # "\\" # tarFile)    EmptyCache(tmpBuf)    	cRow = sel.lnFirst	while (cRow <= sel.lnLast)	{		AppendBufLine(tmpBuf, GetBufLine( hbuf, cRow))		cRow = cRow + 1	}	SaveBuf(tmpBuf)	CloseBuf(tmpBuf)					if (onoff == 1)	{		onoff = 2	}	else	{		onoff = 1	}	SaveMode(getBCompareOnOff(0), "@onoff@")		if (onoff == 2)	{		onoff = 2		ShellBCompare(getNodePath(0) # "\\Tmp_Comp_1.h", getNodePath(0) # "\\Tmp_Comp_2.h")	}}/***********************************************************************//****************************    SVN  *********************************//***********************************************************************/macro SVN(key){	//_TempHeadF7(hbuf)    SvnUpdate()    SvnCommit(key)}macro SvnUpdate(key){	//_TempHeadF7(hbuf)    hwnd = GetCurrentWnd()    hbuf = GetCurrentBuf()	if (hwnd == 0)	{    	stop	}			pathName = GetBufName(hbuf)	//获取根目录（F:\6531E_16A）	baseDir = getBasePath(pathName)	//在搜索结果窗口，更新根目录	ShellSvnUpdate(baseDir)}macro SvnCommit(key){	//_TempHeadF7(hbuf)    hwnd = GetCurrentWnd()    hbuf = GetCurrentBuf()	if (hwnd == 0)	{    	stop	}			pathName = GetBufName(hbuf)	curPath = getSVNCommitPath(pathName)	//msg ("curPath  " #  "@curPath@")	ShellSvnCommit(curPath)    }//上传目录：//    project\XXX//    MS_Customize//    MS_MMI\\source\\mmi_appmacro getSVNCommitPath(pathName){	//_TempHeadF7(hbuf)	//获取目录 6531XX:	baseDir = getBasePath(pathName)			ret = CompareEx(pathName, "@baseDir@\\MS_Customize", 1)	if(ret ==0)	{		return "@baseDir@\\MS_Customize"	}		ret = CompareEx(pathName, "@baseDir@\\MS_MMI\\source\\mmi_app", 1)	if(ret ==0)	{		return "@baseDir@\\MS_MMI\\source\\mmi_app"	}		ret = CompareEx(pathName, "@baseDir@\\project", 1)//left 包含 right(包含6531XX/project)	if(ret ==0)	{		index = SplitMacro(pathName, "\\", strlen("@baseDir@\\project")+1, strlen(pathName))		return strmid(pathName, 0, index)	}	return baseDir # "\\project"}